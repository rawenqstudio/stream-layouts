<!doctype html><html lang="pl"><head><meta charset="UTF-8"><title>GO≈öƒÜ - Ustawienia</title><script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script><style>body{font-family:"Segoe UI",sans-serif;text-align:center;background:#222;color:#fff;padding:20px;margin:0}.container{max-width:600px;margin:0 auto;background:#333;padding:20px;border-radius:10px;box-shadow:0 0 20px rgba(0,0,0,.5)}h1{margin-top:0;color:#00d2ff}.video-wrapper{position:relative;width:100%;aspect-ratio:16/9;background:#000;border-radius:8px;overflow:hidden;margin-bottom:20px;border:2px solid #555}video{width:100%;height:100%;object-fit:cover;transform:scaleX(-1)}#mute-indicator{position:absolute;top:10px;right:10px;background:red;color:#fff;padding:5px 10px;border-radius:5px;font-weight:700;display:none;box-shadow:0 0 5px #000;font-size:.8em;z-index:10}.settings-group{text-align:left;margin-bottom:15px}label{display:block;margin-bottom:5px;color:#ccc;font-size:.9em}input[type=text],select{width:100%;padding:10px;background:#222;border:1px solid #555;color:#fff;border-radius:5px;box-sizing:border-box}.checkbox-group{display:flex;align-items:center;gap:10px;margin-bottom:10px;cursor:pointer}input[type=checkbox]{width:20px;height:20px;cursor:pointer}button{padding:15px;font-size:18px;font-weight:700;cursor:pointer;background:#28a745;color:#fff;border:none;border-radius:5px;width:100%;margin-top:10px;transition:.2s}button:hover{background:#218838}button:disabled{background:#555;cursor:not-allowed;color:#aaa}#logs{margin-top:20px;color:#aaa;font-size:.8em;text-align:left;background:#111;padding:10px;border-radius:5px;font-family:monospace;max-height:150px;overflow-y:auto}.error{color:#f44}.success{color:#0f0}#target-id{display:none}#monitor-area{display:none;margin-top:20px;border-top:1px solid #555;padding-top:15px}.btn-monitor{background:#ff9800;color:#fff}.btn-monitor:hover{background:#e68900}.footer-credits{position:fixed;bottom:15px;right:20px;color:#666;font-size:.85em;font-family:monospace;user-select:none;pointer-events:none}</style></head><body><div class="container"><h1>Ustawienia Studia</h1><div class="video-wrapper"><video id="localVideo" autoplay muted playsinline></video><div id="mute-indicator">üîá WYCISZONY</div></div><div class="settings-group"><label>üì∑ Wybierz Kamerƒô:</label> <select id="videoSource" onchange="startPreview()"></select></div><div class="settings-group"><label>üé§ Wybierz Mikrofon:</label> <select id="audioSource" onchange="startPreview()"></select></div><div class="settings-group"><label class="checkbox-group"><input type="checkbox" id="start-muted" checked="checked"> <span>Do≈ÇƒÖcz z wyciszonym mikrofonem</span></label> <label class="checkbox-group" title="Wymusza wysoki bitrate (6 Mbps)"><input type="checkbox" id="high-bitrate"> <span>üî• Unlock Bitrate</span></label></div><div class="settings-group"><label>Twoje Imiƒô:</label> <input type="text" id="username" placeholder="Wpisz swoje imiƒô..."></div><input type="text" id="target-id"> <button id="join-btn" onclick="joinRoom()" disabled="disabled">≈Åadowanie kamery...</button><div id="monitor-area"><p style="margin-bottom:10px;color:#ccc">Potrzebujesz widzieƒá grƒô i innych?</p><button id="btn-open-monitor" class="btn-monitor">üìã Skopiuj Link PodglƒÖdu (Ukryj moje has≈Ço)</button></div><div id="logs"></div></div><div class="footer-credits">from xrawenq for Goodiez</div><script>function log(e,t="info"){const n=document.getElementById("logs"),o=document.createElement("div");o.innerText=`> ${e}`,"error"===t&&(o.className="error"),"success"===t&&(o.className="success"),n.prepend(o),console.log(e)}const urlParams=new URLSearchParams(window.location.search),useStunOnly=urlParams.get("stunonly"),isMulti=urlParams.get("multi"),selectedConfig=useStunOnly?[{urls:"stun:stun.l.google.com:19302"}]:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80?transport=udp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:80?transport=tcp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=udp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"}],peer=new Peer(void 0,{config:{iceServers:selectedConfig}});let localStream=null,globalConn=null,directorConn=null;const activeCallIds=[],videoSelect=document.getElementById("videoSource"),audioSelect=document.getElementById("audioSource"),joinBtn=document.getElementById("join-btn");async function requestPermissions(){try{(await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})).getTracks().forEach(e=>e.stop())}catch(e){log("B≈ÇƒÖd uprawnie≈Ñ: "+e.name,"error"),alert("Musisz zezwoliƒá na dostƒôp do kamery i mikrofonu!"),joinBtn.innerText="BRAK DOSTƒòPU"}}async function getDevices(){const e=await navigator.mediaDevices.enumerateDevices();videoSelect.innerHTML="",audioSelect.innerHTML="",e.forEach(e=>{const t=document.createElement("option");t.value=e.deviceId,"videoinput"===e.kind?(t.text=e.label||`Kamera ${videoSelect.length+1}`,videoSelect.appendChild(t)):"audioinput"===e.kind&&(t.text=e.label||`Mikrofon ${audioSelect.length+1}`,audioSelect.appendChild(t))})}async function startPreview(){joinBtn.disabled=!0,joinBtn.innerText="Ustawianie kamery...",localStream&&localStream.getTracks().forEach(e=>e.stop());const e={video:{deviceId:videoSelect.value?{exact:videoSelect.value}:void 0,width:{ideal:1920},height:{ideal:1080}},audio:{deviceId:audioSelect.value?{exact:audioSelect.value}:void 0}};try{localStream=await navigator.mediaDevices.getUserMedia(e),document.getElementById("localVideo").srcObject=localStream,checkMuteState(),joinBtn.disabled=!1,joinBtn.innerText="DO≈ÅƒÑCZ DO STUDIA",log("Kamera gotowa. Mo≈ºesz do≈ÇƒÖczyƒá.","success")}catch(e){log("B≈ÇƒÖd podglƒÖdu: "+e.name,"error"),joinBtn.innerText="B≈ÅƒÑD KAMERY"}}function checkMuteState(){if(!localStream)return;const e=document.getElementById("start-muted").checked,t=localStream.getAudioTracks()[0];t&&(t.enabled=!e,toggleMuteUI(e))}function toggleMuteUI(e){document.getElementById("mute-indicator").style.display=e?"block":"none"}async function joinRoom(){const e=document.getElementById("target-id").value,t=document.getElementById("username").value.trim(),n=document.getElementById("high-bitrate").checked;joinBtn.disabled=!0,joinBtn.innerText="≈ÅƒÖczenie...",videoSelect.disabled=!0,audioSelect.disabled=!0,generateMonitorLink(e,t),log("Dzwoniƒô do OBS...");const o=localStream.getVideoTracks()[0];o&&"contentHint"in o&&(o.contentHint="motion",log("Ustawiono priorytet: Motion")),isMulti?(log("Tryb Multi: ≈ÅƒÖczƒô z Re≈ºyserem..."),directorConn=peer.connect(e),directorConn.on("open",()=>{log("Po≈ÇƒÖczono z Re≈ºyserem. Pobieram listƒô ekran√≥w...","success"),directorConn.send({type:"get-obs-list"}),directorConn.send({type:"identify",name:t});const e=document.getElementById("start-muted").checked;directorConn.send({type:"mic-status",muted:e}),setInterval(()=>{directorConn.open&&directorConn.send({type:"heartbeat"})},2e3)}),directorConn.on("data",e=>{"obs-list"===e.type&&(log(`Aktualizacja listy OBS: znaleziono ${e.targets.length}`),e.targets.forEach(e=>{activeCallIds.includes(e)||callSingleOBS(e,t,n)}),joinBtn.innerText="JESTE≈ö NA WIZJI (MULTI)",joinBtn.style.background="#dc3545",document.getElementById("monitor-area").style.display="block"),"force-sync"===e.type&&(log("Otrzymano rozkaz synchronizacji...","info"),directorConn.send({type:"get-obs-list"})),handleRemoteCommand(e)})):(log("Tryb Standard: Dzwoniƒô do OBS..."),callSingleOBS(e,t,n)),window.addEventListener("beforeunload",()=>{directorConn&&directorConn.open&&directorConn.send({type:"leave"}),globalConn&&globalConn.open&&globalConn.send({type:"leave"})})}function generateMonitorLink(e,t){const n=document.getElementById("btn-open-monitor");let o=window.location.href.split("guest.html")[0],a=`?room=${e}`;useStunOnly&&(a+="&stunonly=1"),isMulti&&(a+="&multi=1"),t&&(a+=`&hide=${encodeURIComponent(t)}`);const i=`${o}obs.html${a}`;n.onclick=()=>{navigator.clipboard.writeText(i).then(()=>{const e=n.innerText;n.innerText="‚úÖ Skopiowano!",n.style.background="#28a745",setTimeout(()=>{n.innerText=e,n.style.background=""},2e3)}).catch(e=>{console.error("B≈ÇƒÖd kopiowania:",e),alert("Nie uda≈Ço siƒô skopiowaƒá automatycznie. Tw√≥j link to:\n"+i)})}}function callSingleOBS(e,t,n){log(`Dzwoniƒô do ekranu: ${e}`),activeCallIds.push(e);const o=peer.call(e,localStream),a=peer.connect(e);isMulti||(globalConn=a),a.on("open",()=>{const e=document.getElementById("start-muted").checked;a.send({type:"identify",name:t}),a.send({type:"mic-status",muted:e}),isMulti||(log("Po≈ÇƒÖczenie zestawione!","success"),joinBtn.innerText="JESTE≈ö NA WIZJI",joinBtn.style.background="#dc3545")}),o.on("close",()=>{const t=activeCallIds.indexOf(e);t>-1&&activeCallIds.splice(t,1)}),o.on("error",()=>{const t=activeCallIds.indexOf(e);t>-1&&activeCallIds.splice(t,1)}),n&&setTimeout(()=>{const e=o.peerConnection.getSenders().find(e=>"video"===e.track.kind);if(e){const t=e.getParameters();t.encodings||(t.encodings=[{}]),t.encodings[0].maxBitrate=6e6,e.setParameters(t).then(()=>{}).catch(e=>{})}},1e3),a.on("data",e=>handleRemoteCommand(e)),setInterval(()=>{a.open&&a.send({type:"heartbeat"})},2e3)}function handleRemoteCommand(e){if("mute-cmd"===e.type){const t=localStream.getAudioTracks()[0];if(t){t.enabled=!e.state,toggleMuteUI(e.state),document.getElementById("start-muted").checked=e.state;const n={type:"mic-status",muted:e.state};directorConn&&directorConn.open&&directorConn.send(n),globalConn&&globalConn.open&&globalConn.send(n)}}}window.onload=async function(){const e=urlParams.get("room");e?(document.getElementById("target-id").value=e,log(`Pok√≥j wykryty: ${e}`),joinBtn.disabled=!0,joinBtn.innerText="Inicjalizacja...",await requestPermissions(),await getDevices(),startPreview()):(log("B≈ÅƒÑD: Brak ID pokoju w linku.","error"),joinBtn.disabled=!0,joinBtn.innerText="B≈ÅƒòDNY LINK")},document.getElementById("start-muted").addEventListener("change",checkMuteState),peer.on("open",e=>log(`Gotowy. Twoje ID: ${e}`,"success"))</script></body></html>