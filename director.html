<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel Re≈ºysera</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #222; color: white; text-align: center; padding: 20px; }
        
        .panel { max-width: 500px; margin: 0 auto; background: #333; padding: 20px; border-radius: 10px; }
        h2 { margin-top: 0; color: #00d2ff; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        
        button { 
            padding: 20px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; 
            background: #444; color: white; transition: 0.2s; 
        }
        button:hover { background: #00d2ff; color: #000; }
        button:active { transform: scale(0.95); }

        .status { margin-bottom: 15px; font-weight: bold; color: #888; }
        .connected { color: #00ff00; }
        .disconnected { color: #ff4444; }
    </style>
</head>
<body>
    <div class="panel">
        <h2>üéõÔ∏è Re≈ºyserka</h2>
        <div id="status-msg" class="status">≈ÅƒÖczenie ze studiem...</div>
        
        <div class="btn-grid">
            <button onclick="sendLayout('layout-grid')">üî≥ Grid (Siatka)</button>
            <button onclick="sendLayout('layout-sidebar-right')">‚û°Ô∏è Pasek Prawy</button>
            <button onclick="sendLayout('layout-bottom')">‚¨áÔ∏è Pasek Dolny</button>
            <button onclick="sendLayout('layout-spotlight')">‚è∫Ô∏è Pe≈Çny Ekran</button>
        </div>
    </div>

    <script>
        const peer = new Peer(); 
        let conn = null;

        // Auto-po≈ÇƒÖczenie po za≈Çadowaniu
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomID = urlParams.get('room');
            
            if(roomID) {
                connectToOBS(roomID);
            } else {
                document.getElementById('status-msg').innerText = "B≈ÇƒÖd: Brak ID pokoju w linku.";
            }
        }

        function connectToOBS(roomID) {
            // ≈ÅƒÖczymy siƒô do ID pokoju (kt√≥ry jest ID OBS-a)
            conn = peer.connect(roomID);

            conn.on('open', () => {
                const stat = document.getElementById('status-msg');
                stat.innerText = "‚úÖ PO≈ÅƒÑCZONO Z OBS";
                stat.className = "status connected";
            });

            conn.on('close', () => {
                document.getElementById('status-msg').innerText = "‚ùå ROZ≈ÅƒÑCZONO";
                document.getElementById('status-msg').className = "status disconnected";
            });
            
            conn.on('error', (err) => console.error("B≈ÇƒÖd po≈ÇƒÖczenia:", err));
        }

        function sendLayout(layoutName) {
            if(conn && conn.open) {
                conn.send({ type: 'layout', mode: layoutName });
                console.log("Wys≈Çano uk≈Çad:", layoutName);
            } else {
                alert("Brak po≈ÇƒÖczenia z OBS! Od≈õwie≈º stronƒô.");
            }
        }
    </script>
</body>
</html>