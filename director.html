<!doctype html><html lang="pl"><head><meta charset="UTF-8"><title>REÅ»YSERKA</title><script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script><style>body{font-family:sans-serif;background:#333;color:#fff;text-align:center;padding:20px}.container{max-width:800px;margin:0 auto}button{cursor:pointer;border:none;border-radius:5px;color:#fff;transition:.2s}button:disabled{opacity:.5;cursor:not-allowed;filter:grayscale(100%)}.btn-layout{background:#007bff;width:45%;padding:12px;font-size:14px;margin:5px}.btn-layout:hover{background:#0056b3}.btn-tool{width:93%;padding:10px;margin:5px auto;display:block;font-weight:700}.btn-refresh-all{background:#ff9800}.btn-refresh-all:hover{background:#e68900}.btn-sync{background:#6610f2}.btn-sync:hover{background:#520dc2}.btn-toggle-off{background:#17a2b8}.btn-toggle-off:hover{background:#117a8b}.btn-toggle-on{background:#28a745}.btn-toggle-game{background:#e91e63;margin-top:30px}.btn-toggle-game:hover{background:#c2185b}.status{margin-top:10px;color:#aaa;font-weight:700}.controls{display:none;margin-top:30px;border-top:1px solid #555;padding-top:20px}input{display:none}#guest-list{margin-top:20px;text-align:left;background:#222;padding:20px;border-radius:10px}.guest-item{display:flex;justify-content:space-between;align-items:center;background:#444;padding:10px;margin-bottom:10px;border-radius:5px;flex-wrap:wrap}.guest-info{display:flex;flex-direction:column;flex-grow:1}.guest-name{font-size:1.2em;font-weight:700}.guest-stats{font-size:.75em;color:#aaa;margin-top:4px;font-family:monospace}.stat-good{color:#0f0}.stat-mid{color:#fc0}.stat-bad{color:#f44;font-weight:700}.guest-actions{display:flex;gap:5px}.btn-icon{width:40px;height:40px;padding:0;display:flex;align-items:center;justify-content:center;font-size:20px}.mic-on{background:#28a745}.mic-off{background:#dc3545}.btn-refresh{background:#ff9800}.btn-refresh:hover{background:#e68900}.btn-mirror{background:#6c757d}.btn-mirror:hover{background:#5a6268}.mirror-on{background:#007bff;border:2px solid #fff}.btn-move{background:#343a40;font-size:14px}.btn-move:hover{background:#495057}.game-section{background:#2a2a2a;padding:15px;border-radius:10px;margin-top:10px;border:1px solid #444;display:none}.game-menu-grid{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}.game-tile{width:45%;padding:20px;background:#444;border-radius:8px;cursor:pointer;transition:.2s;font-weight:700}.game-tile:hover{background:#555;transform:scale(1.05)}.game-tile-active{background:#e91e63}#game-heads-up{display:none}.game-select{width:100%;padding:10px;background:#444;color:#fff;border:none;border-radius:5px;font-size:16px;margin-bottom:10px}.btn-game-back{background:#666;width:100%;padding:8px;margin-bottom:15px}.btn-game-start{background:#e91e63;width:48%;display:inline-block;padding:12px;font-weight:700}.btn-game-clear{background:#555;width:48%;display:inline-block;padding:12px;font-weight:700}#game-players-list{margin-top:15px;text-align:left;width:100%}.game-player-row{display:flex;align-items:center;gap:8px;margin-bottom:8px;background:#3a3a3a;padding:10px;border-radius:5px;border:1px solid #555}.game-player-name{width:90px;min-width:90px;font-weight:700;font-size:.9em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}input.game-input{display:inline-block!important;background:#fff!important;border:2px solid #666!important;color:#000!important;padding:8px!important;flex-grow:1;min-width:50px;border-radius:4px;font-size:14px;height:auto}input.game-input:focus{border-color:#00d2ff!important;outline:0}.btn-mini{padding:8px 12px;font-size:13px;width:auto;font-weight:700;border-radius:4px;border:none;cursor:pointer;color:#fff;transition:.2s}.btn-reroll{background:#9c27b0}.btn-reroll:hover{background:#7b1fa2}.btn-send{background:#009688}.btn-send:hover{background:#00796b}#free-mode-container{display:none;margin-top:20px}#free-mode-stage{display:block;width:100%;aspect-ratio:16/9;background:#000;outline:2px solid #00d2ff;position:relative;margin-top:20px;overflow:hidden;box-sizing:border-box;background-image:linear-gradient(rgba(255,255,255,.1) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.1) 1px,transparent 1px);background-size:10% 10%}.stage-box{position:absolute;background:rgba(0,123,255,.8);border:2px solid #fff;color:#fff;font-size:11px;display:flex;align-items:center;justify-content:center;cursor:grab;user-select:none;overflow:hidden;text-align:center;line-height:1.2;padding:2px;box-sizing:border-box}.stage-box:active{cursor:grabbing;border-color:#ff0;z-index:1000;background:#007bff}.btn-free-mode{background:#28a745;width:90%;margin-top:20px}.resize-handle{width:15px;height:15px;background:linear-gradient(135deg,transparent 50%,#fff 50%);position:absolute;right:0;bottom:0;cursor:se-resize;z-index:10}.resize-handle:hover{background:linear-gradient(135deg,transparent 50%,#ff0 50%)}.btn-lock-on{background:#dc3545}.btn-lock-on:hover{background:#c82333}.btn-lock-off{background:#28a745}.btn-lock-off:hover{background:#218838}.stage-box.locked{cursor:not-allowed!important;opacity:.7}.stage-box.locked .resize-handle{display:none}.guide-line{position:absolute;background-color:red;z-index:999;display:none;pointer-events:none}.guide-x{width:100%;height:1px;left:0}.guide-y{height:100%;width:1px;top:0}</style></head><body><div class="container"><h1>Panel ReÅ¼ysera</h1><div class="status" id="status-msg">Inicjalizacja...</div><input type="text" id="target-id"><div class="controls" id="control-panel"><h2>ğŸ¥ UkÅ‚ad kamer:</h2><div style="margin-bottom:15px;border-bottom:1px solid #555;padding-bottom:10px"><button class="btn-layout" onclick='sendLayout("layout-grid")' style="width:90%;background:#6f42c1">ğŸ”³ PeÅ‚na Siatka (Grid)</button></div><div style="display:flex;justify-content:center;flex-wrap:wrap;gap:5px"><button class="btn-layout" onclick='sendLayout("layout-top")'>â¬†ï¸ GÃ³ra</button> <button class="btn-layout" onclick='sendLayout("layout-bottom")'>â¬‡ï¸ DÃ³Å‚</button> <button class="btn-layout" onclick='sendLayout("layout-sidebar-left")'>â¬…ï¸ Lewo</button> <button class="btn-layout" onclick='sendLayout("layout-sidebar-right")'>â¡ï¸ Prawo</button></div><div style="margin-top:10px"><button class="btn-layout" onclick='sendLayout("layout-split")' style="width:90%;background:#e83e8c">â†”ï¸ Obie Strony (Split)</button></div><div style="margin-top:5px"><button class="btn-layout" onclick='sendLayout("layout-center-stage")' style="width:90%;background:#6610f2">â­ï¸ Center Stage</button></div><button class="btn-layout btn-free-mode" onclick="toggleFreeMode()">ğŸ”“ Swobodne Ustawianie (Free Mode)</button><div id="free-mode-container"><button id="btn-lock-layout" class="btn-tool btn-lock-off" style="margin-bottom:10px" onclick="toggleLayoutLock()">ğŸ”“ UkÅ‚ad: ODBLOKOWANY</button><div id="free-mode-stage"><div id="guide-x" class="guide-line guide-x"></div><div id="guide-y" class="guide-line guide-y"></div><p style="color:#555;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100%;pointer-events:none">StÃ³Å‚ MontaÅ¼owy (16:9)<br><small>Przesuwanie: ChwyÄ‡ Å›rodek<br>Skalowanie: ChwyÄ‡ prawy dolny rÃ³g (SHIFT = crop)</small></p></div></div><h2 style="margin-top:30px">âš™ï¸ NarzÄ™dzia:</h2><button class="btn-tool btn-toggle-off" id="btn-labels" onclick="toggleLabels()">ğŸ”¤ Podpisy: UKRYTE</button> <button class="btn-tool btn-toggle-off" id="btn-icons" onclick="toggleIcons()">ğŸ”‡ Ikony Mute: UKRYTE</button> <button class="btn-tool btn-refresh-all" onclick='refreshCam("all")' style="margin-top:20px">ğŸ”„ OdÅ›wieÅ¼ Bufory (Fix Lag)</button> <button class="btn-tool btn-sync" onclick="syncGuestsWithOBS()">ğŸ“¡ WymuÅ› poÅ‚Ä…czenie z nowym OBS</button> <button class="btn-tool btn-toggle-game" onclick="toggleGamePanel()">ğŸ® PokaÅ¼ Panel Gier</button><div id="game-section" class="game-section"><div id="game-menu"><h3>Wybierz GrÄ™:</h3><div class="game-menu-grid"><div class="game-tile game-tile-active" onclick='openGame("heads-up")'>ğŸ² CzÃ³Å‚ko<br><span style="font-size:.8em;font-weight:400">HasÅ‚a na czoÅ‚o</span></div><div class="game-tile" style="opacity:.5;cursor:not-allowed">ğŸš§ Kalambury<br><span style="font-size:.8em;font-weight:400">(WkrÃ³tce)</span></div></div></div><div id="game-heads-up"><button class="btn-game-back" onclick="closeGame()">â¬… WrÃ³Ä‡ do menu</button><h3 style="margin-top:0">Gra: CzÃ³Å‚ko</h3><select id="game-category" class="game-select"><option value="ZwierzÄ™ta">ğŸ¶ ZwierzÄ™ta</option><option value="Filmy">ğŸ¬ Filmy</option><option value="Postacie">ğŸ¦¸ Postacie Fikcyjne</option><option value="Zawody">ğŸ‘· Zawody</option><option value="Przedmioty">ğŸ“¦ Przedmioty</option></select><div style="display:flex;justify-content:space-between;margin-bottom:15px"><button class="btn-game-clear" onclick="clearGame()">ğŸ—‘ï¸ WyczyÅ›Ä‡ Wszystkich</button> <button class="btn-game-start" onclick="dealCards()">ğŸ² Rozdaj Wszystkim</button></div><hr style="border:0;border-top:1px solid #444;margin:15px 0"><p style="color:#aaa;font-size:.8em;margin-bottom:5px">ZarzÄ…dzanie rÄ™czne (Wpisz i kliknij WyÅ›lij):</p><div id="game-players-list"></div></div></div><h2>ğŸ¤ ZarzÄ…dzanie GoÅ›Ä‡mi:</h2><div id="guest-list"><p style="text-align:center;color:#777">Oczekiwanie na goÅ›ci...</p></div><p style="color:#555;font-size:.8em;margin-top:10px">Easter Egg: Ctrl + Shift + F</p></div></div><script>const OBS_WIDTH=1920,OBS_HEIGHT=1080,CAM_WIDTH=320,CAM_HEIGHT=180,CAM_WIDTH_PCT=320/1920*100,CAM_HEIGHT_PCT=180/1080*100;function pxToW(e){return e/1920*100}function pxToH(e){return e/1080*100}const gameData={"ZwierzÄ™ta":["SÅ‚oÅ„","Å»yrafa","Chomik","Pingwin","Rekin","WÄ…Å¼","OrzeÅ‚","Biedronka","Krowa","Kangur","Zebra","Lew","Åšwinka","Pies","Kot","Papuga","Krokodyl","MaÅ‚pa","NiedÅºwiedÅº","Å»aba"],Filmy:["Titanic","Shrek","Matrix","Harry Potter","Gwiezdne Wojny","KrÃ³l Lew","WÅ‚adca PierÅ›cieni","Joker","Avengers","Batman","Spider-Man","Forrest Gump","Kraina Lodu","Minionki","Piraci z KaraibÃ³w"],Postacie:["Myszka Miki","Superman","ÅšwiÄ™ty MikoÅ‚aj","Sherlock Holmes","Mario","Pikachu","Vader","WiedÅºmin","Shrek","Barbie","SpongeBob","Hulk","Iron Man","Tarzan","Zorro"],Zawody:["StraÅ¼ak","Policjant","Lekarz","Nauczyciel","Kucharz","Kierowca","Pilot","Astronauta","Hydraulik","Fryzjer","Aktor","Piosenkarz","Malarz","Rolnik","Programista"],Przedmioty:["KrzesÅ‚o","Telefon","SamochÃ³d","DÅ‚ugopis","Butelka","KsiÄ…Å¼ka","Komputer","Zegarek","Lustro","Klucz","MÅ‚otek","Szczoteczka","Widelec","Okulary","Poduszka"]},urlParams=new URLSearchParams(window.location.search),useStunOnly=urlParams.get("stunonly"),isMulti=urlParams.get("multi"),roomID=urlParams.get("room"),selectedConfig=useStunOnly?[{urls:"stun:stun.l.google.com:19302"}]:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80?transport=udp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"}],peer=new Peer(isMulti?roomID:void 0,{config:{iceServers:selectedConfig}});let conn=null;const obsClients=[],guestConnections=[],multiGuestsState={};let guestOrder=[],labelsVisible=!1,iconsVisible=!1;const currentWords={};let isLayoutLocked=!1;function toggleGamePanel(){const e=document.getElementById("game-section");"block"===e.style.display?e.style.display="none":(e.style.display="block",document.getElementById("game-menu").style.display="block",document.getElementById("game-heads-up").style.display="none")}function openGame(e){document.getElementById("game-menu").style.display="none",document.getElementById("game-heads-up").style.display="block",renderGameControls()}function closeGame(){document.getElementById("game-heads-up").style.display="none",document.getElementById("game-menu").style.display="block"}function dealCards(){const e=document.getElementById("game-category").value,t=[...gameData[e]];let o=isMulti?Object.keys(multiGuestsState):guestOrder;0!==o.length?(o.forEach(o=>{0===t.length&&t.push(...gameData[e]);const n=Math.floor(Math.random()*t.length),s=t[n];t.splice(n,1),currentWords[o]=s}),broadcastCommand({type:"game-deal",cards:currentWords}),renderGameControls()):alert("Brak goÅ›ci do rozdania kart!")}function clearGame(){for(let e in currentWords)delete currentWords[e];broadcastCommand({type:"game-clear"}),renderGameControls()}function updateGuestWord(e){const t=document.getElementById(`word-input-${e}`),o=t.value;currentWords[e]=o,broadcastCommand({type:"game-update-card",targetId:e,word:o}),t.style.borderColor="#00ff00",setTimeout(()=>{t.style.borderColor="#666"},500)}function rerollGuest(e){const t=document.getElementById("game-category").value,o=gameData[t],n=o[Math.floor(Math.random()*o.length)],s=document.getElementById(`word-input-${e}`);s&&(s.value=n),updateGuestWord(e)}function renderGameControls(){const e=document.getElementById("game-players-list");e.innerHTML="";let t=isMulti?Object.keys(multiGuestsState):guestOrder;0!==t.length?t.forEach(t=>{const o=multiGuestsState[t]?multiGuestsState[t].name:"GoÅ›Ä‡",n=currentWords[t]||"",s=document.createElement("div");s.className="game-player-row",s.innerHTML=` <div class="game-player-name" title="${o}">${o}</div> <input type="text" id="word-input-${t}" class="game-input" value="${n}" placeholder="Wpisz hasÅ‚o..."> <button class="btn-mini btn-reroll" onclick="rerollGuest('${t}')" title="Losuj z kategorii">ğŸ²</button> <button class="btn-mini btn-send" onclick="updateGuestWord('${t}')" title="WyÅ›lij rÄ™cznie wpisane">WyÅ›lij</button> `,e.appendChild(s)}):e.innerHTML="<p style='color:#aaa; font-style:italic;'>Brak aktywnych goÅ›ci.</p>"}function addFakeGuest(){const e="fake-"+Math.floor(1e4*Math.random()),t=["Sztuczny Jan","Testowa Anna","Bot Marek","Demo Zosia"],o=t[Math.floor(Math.random()*t.length)];broadcastCommand({type:"add-fake-guest",id:e,name:o,img:`https://picsum.photos/seed/${e}/640/360`}),multiGuestsState[e]={id:e,name:o,muted:!1,mirrored:!1,conn:null},guestOrder.includes(e)||guestOrder.push(e),refreshMultiModeUI(),renderGameControls(),renderFreeStage()}function connectToOBS(){const e=document.getElementById("target-id").value;conn=peer.connect(e),conn.on("open",()=>{document.getElementById("status-msg").innerText="âœ… POÅÄ„CZONO Z OBS (Standard)",document.getElementById("status-msg").style.color="#00ff00",document.getElementById("control-panel").style.display="block",conn.send({type:"director-hello"})}),conn.on("data",e=>handleData(e)),conn.on("error",e=>alert("BÅ‚Ä…d: "+e))}function handleIncomingConnection(e){e.on("open",()=>console.log("PoÅ‚Ä…czenie:",e.peer)),e.on("data",t=>{if("register-obs"===t.type&&(obsClients.push(e),updateStatusMsg(),e.send({type:"toggle-labels",show:labelsVisible}),e.send({type:"toggle-icons",show:iconsVisible}),e.send({type:"layout",mode:"layout-grid"}),guestOrder.length>0&&e.send({type:"reorder-guests",order:guestOrder})),"get-obs-list"===t.type){guestConnections.includes(e)||guestConnections.push(e);const t=obsClients.map(e=>e.peer);e.send({type:"obs-list",targets:t})}handleData(t,e)}),e.on("close",()=>{let t=obsClients.indexOf(e);t>-1&&obsClients.splice(t,1),t=guestConnections.indexOf(e),t>-1&&guestConnections.splice(t,1),multiGuestsState[e.peer]&&(delete multiGuestsState[e.peer],guestOrder=guestOrder.filter(t=>t!==e.peer),refreshMultiModeUI(),renderGameControls(),renderFreeStage()),updateStatusMsg()})}function updateStatusMsg(){document.getElementById("status-msg").innerText=`âœ… OBS: ${obsClients.length} | GoÅ›ci: ${guestConnections.length}`,document.getElementById("status-msg").style.color="#00ff00"}function handleData(e,t){if("guest-list"===e.type&&!isMulti){e.list.forEach(e=>{multiGuestsState[e.id]=e,guestOrder.includes(e.id)||guestOrder.push(e.id)});const t=e.list.map(e=>e.id);guestOrder=guestOrder.filter(e=>t.includes(e)),refreshMultiModeUI(),renderGameControls(),renderFreeStage()}"stats-update"===e.type&&updateStats(e.stats),isMulti&&("identify"===e.type&&t&&(guestConnections.includes(t)||guestConnections.push(t),multiGuestsState[t.peer]={id:t.peer,name:e.name||"GoÅ›Ä‡",muted:!1,mirrored:!1,conn:t},guestOrder.includes(t.peer)||guestOrder.push(t.peer),refreshMultiModeUI(),renderGameControls(),renderFreeStage(),updateStatusMsg()),"mic-status"===e.type&&t&&multiGuestsState[t.peer]&&(multiGuestsState[t.peer].muted=e.muted,refreshMultiModeUI(),obsClients.forEach(o=>{o.open&&o.send({type:"mic-status",peer:t.peer,muted:e.muted})})))}function refreshMultiModeUI(){const e=[];guestOrder.forEach(t=>{multiGuestsState[t]&&e.push(multiGuestsState[t])}),renderGuestList(e),renderFreeStage()}function moveGuest(e,t){const o=guestOrder.indexOf(e);if(-1!==o){if("up"===t&&o>0)[guestOrder[o],guestOrder[o-1]]=[guestOrder[o-1],guestOrder[o]];else{if(!("down"===t&&o<guestOrder.length-1))return;[guestOrder[o],guestOrder[o+1]]=[guestOrder[o+1],guestOrder[o]]}refreshMultiModeUI(),renderGameControls(),renderFreeStage(),broadcastCommand({type:"reorder-guests",order:guestOrder})}}function broadcastCommand(e){isMulti?obsClients.forEach(t=>{t.open&&t.send(e)}):conn&&conn.open&&conn.send(e)}function syncGuestsWithOBS(){if(!isMulti)return void alert("Tylko Multi!");const e=document.querySelector(".btn-sync");e.innerText="â³ Synchronizacja...",guestConnections.forEach(e=>{e.open&&e.send({type:"force-sync"})}),setTimeout(()=>{e.innerText="ğŸ“¡ WymuÅ› poÅ‚Ä…czenie z nowym OBS"},1e3)}function toggleGuestMic(e,t){if(isMulti){const o=multiGuestsState[e];if(e.startsWith("fake-"))return o.muted=!t,refreshMultiModeUI(),void broadcastCommand({type:"remote-mute",targetId:e,state:o.muted});o&&o.conn&&o.conn.open&&o.conn.send({type:"mute-cmd",state:!t})}else broadcastCommand({type:"remote-mute",targetId:e,state:!t})}function refreshCam(e){broadcastCommand({type:"refresh-cam",targetId:e})}function toggleMirror(e){isMulti&&multiGuestsState[e]&&(multiGuestsState[e].mirrored=!multiGuestsState[e].mirrored,refreshMultiModeUI()),broadcastCommand({type:"toggle-mirror",targetId:e})}function toggleLabels(){labelsVisible=!labelsVisible,broadcastCommand({type:"toggle-labels",show:labelsVisible}),updateToolBtn("btn-labels",labelsVisible,"ğŸ”¤ Podpisy")}function toggleIcons(){iconsVisible=!iconsVisible,broadcastCommand({type:"toggle-icons",show:iconsVisible}),updateToolBtn("btn-icons",iconsVisible,"ğŸ”‡ Ikony Mute")}function updateToolBtn(e,t,o){const n=document.getElementById(e);n.innerText=t?`${o}: WIDOCZNE`:`${o}: UKRYTE`,n.className=t?"btn-tool btn-toggle-on":"btn-tool btn-toggle-off"}function renderGuestList(e){const t=document.getElementById("guest-list");t.innerHTML="",0!==e.length?e.forEach((o,n)=>{const s=document.createElement("div");s.className="guest-item";const a=o.muted?"mic-off":"mic-on",l=o.muted?"ğŸ”‡":"ğŸ¤",r=o.muted?"(Wyciszony)":"",i=o.mirrored?"mirror-on":"mirror-off",d=0===n?"visibility:hidden":"",c=n===e.length-1?"visibility:hidden":"";s.innerHTML=` <div class="guest-actions" style="margin-right: 10px;"> <button class="btn-icon btn-move" onclick="moveGuest('${o.id}', 'up')" style="${d}">â¬†ï¸</button> <button class="btn-icon btn-move" onclick="moveGuest('${o.id}', 'down')" style="${c}">â¬‡ï¸</button> </div> <div class="guest-info"> <span class="guest-name">${o.name} <small style="font-weight:normal; font-size:0.7em">${r}</small></span> <span id="stats-${o.id}" class="guest-stats">${o.id.startsWith("fake-")?"SZTUCZNY GOÅšÄ†":"Czekam na dane..."}</span> </div> <div class="guest-actions"> <button class="btn-icon ${i}" onclick="toggleMirror('${o.id}')" title="Lustrzane odbicie">ğŸª</button> <button class="btn-icon btn-refresh" onclick="refreshCam('${o.id}')" title="OdÅ›wieÅ¼">ğŸ”„</button> <button class="btn-icon btn-mic ${a}" onclick="toggleGuestMic('${o.id}', ${o.muted})" title="Wycisz/Odcisz">${l}</button> </div> `,t.appendChild(s)}):t.innerHTML='<p style="text-align:center; color:#777;">Brak goÅ›ci online.</p>'}function updateStats(e){for(const[t,o]of Object.entries(e)){const e=document.getElementById(`stats-${t}`);if(e){let t="stat-good";(o.bitrate<1e3||o.packetLoss>5)&&(t="stat-mid"),(o.bitrate<300||o.packetLoss>15)&&(t="stat-bad"),e.innerHTML=`Bitrate: <span class="${t}">${o.bitrate} kbps</span> | Loss: <span class="${t}">${o.packetLoss}</span> | Res: ${o.resolution}`}}}function toggleLayoutLock(){isLayoutLocked=!isLayoutLocked;const e=document.getElementById("btn-lock-layout");isLayoutLocked?(e.innerText="ğŸ”’ UkÅ‚ad: ZABLOKOWANY",e.className="btn-tool btn-lock-on"):(e.innerText="ğŸ”“ UkÅ‚ad: ODBLOKOWANY",e.className="btn-tool btn-lock-off");document.querySelectorAll(".btn-layout:not(.btn-free-mode)").forEach(e=>{e.disabled=isLayoutLocked,e.style.opacity=isLayoutLocked?"0.5":"1",e.style.cursor=isLayoutLocked?"not-allowed":"pointer"}),renderFreeStage()}function toggleFreeMode(){const e=document.getElementById("free-mode-container");"block"===e.style.display?(e.style.display="none",sendLayout("layout-grid")):(e.style.display="block",broadcastCommand({type:"layout",mode:"layout-free"}),setTimeout(syncFreeStageToOBS,100),renderFreeStage())}function syncFreeStageToOBS(){document.getElementById("free-mode-stage").querySelectorAll(".stage-box").forEach(e=>{let t=parseFloat(e.style.left),o=parseFloat(e.style.top),n=parseFloat(e.style.width),s=parseFloat(e.style.height);isNaN(t)||isNaN(o)||broadcastCommand({type:"transform-update",targetId:e.dataset.id,x:t,y:o,w:n,h:s})})}function sendLayout(e){const t="block"===document.getElementById("free-mode-container").style.display;t&&isLayoutLocked||(t?applyPresetToFreeMode(e):broadcastCommand({type:"layout",mode:e}))}function applyPresetToFreeMode(e){let t=isMulti?Object.keys(multiGuestsState):guestOrder;const o=t.length;if(0===o)return;const n=pxToW(15),s=(pxToW(20),pxToH(20),{});if("layout-grid"===e){const e=Math.ceil(Math.sqrt(o)),a=Math.ceil(o/e);let l,r;l=1===o?85:2===o?48:o<=4?45:o<=6||o<=9?32:23,r=1===o?85:2===o?60:o<=6?45:o<=9?30:23;const i=l*e+n*(e-1),d=r*a+pxToH(15)*(a-1),c=(100-i)/2,u=(100-d)/2;t.forEach((t,d)=>{const m=d%e,y=Math.floor(d/e),p=y===a-1&&o%e||e,g=c+(i-(l*p+n*(p-1)))/2;s[t]={x:g+m*(l+n),y:u+y*(r+pxToH(15)),w:l,h:r}})}else if("layout-sidebar-right"===e){const e=pxToW(320),n=pxToH(180),a=pxToH(15),l=o*n+(o-1)*a,r=Math.max(0,(100-l)/2);t.forEach((t,o)=>{s[t]={x:100-e-pxToW(20),y:r+o*(n+a),w:e,h:n}})}else if("layout-sidebar-left"===e){const e=pxToW(320),n=pxToH(180),a=pxToH(15),l=o*n+(o-1)*a,r=Math.max(0,(100-l)/2);t.forEach((t,o)=>{s[t]={x:pxToW(20),y:r+o*(n+a),w:e,h:n}})}else if("layout-bottom"===e){const e=pxToW(280),n=pxToH(157),a=pxToW(20),l=o*e+(o-1)*a,r=Math.max(0,(100-l)/2);t.forEach((t,o)=>{s[t]={x:r+o*(e+a),y:100-n-pxToH(20),w:e,h:n}})}else if("layout-top"===e){const e=pxToW(280),n=pxToH(157),a=pxToW(20),l=o*e+(o-1)*a,r=Math.max(0,(100-l)/2);t.forEach((t,o)=>{s[t]={x:r+o*(e+a),y:pxToH(20),w:e,h:n}})}else if("layout-split"===e){const e=pxToW(320),n=pxToH(180),a=pxToH(30),l=Math.ceil(o/2),r=l*n+(l-1)*a,i=Math.max(0,(100-r)/2),d=pxToW(40),c=100-pxToW(40)-e;t.forEach((t,o)=>{const l=o%2!=0,r=Math.floor(o/2);s[t]={x:l?c:d,y:i+r*(n+a),w:e,h:n}})}else if("layout-center-stage"===e){const e=pxToW(300),n=pxToH(169),a=pxToH(15),l=pxToW(20),r=pxToW(15);let i=(100-2*l-2*e-2*r)*(9/16)*(1920/1080);i>90&&(i=90);const d=i*(16/9)*.5625,c=(100-d)/2,u=(100-i)/2,m=l,y=100-l-e,p=Math.max(0,o-1),g=Math.ceil(p/2),f=(100-(g*n+(g-1)*a))/2;let h=0;t.forEach((t,o)=>{if(0===o)s[t]={x:c,y:u,w:d,h:i};else{const o=Math.floor(h/2),l=h%2!=0;s[t]={x:l?y:m,y:f+o*(n+a),w:e,h:n},h++}})}const a=document.getElementById("free-mode-stage");for(const[e,t]of Object.entries(s)){let o=a.querySelector(`.stage-box[data-id="${e}"]`);o&&(o.style.left=t.x+"%",o.style.top=t.y+"%",o.style.width=t.w+"%",o.style.height=t.h+"%",broadcastCommand({type:"transform-update",targetId:e,x:parseFloat(t.x.toFixed(4)),y:parseFloat(t.y.toFixed(4)),w:parseFloat(t.w.toFixed(4)),h:parseFloat(t.h.toFixed(4))}))}}function renderFreeStage(){const e=document.getElementById("free-mode-stage");let t=isMulti?Object.keys(multiGuestsState):guestOrder;Array.from(e.children).forEach(e=>{"P"===e.tagName||e.classList.contains("guide-line")||t.includes(e.dataset.id)||e.remove()}),t.forEach((t,o)=>{let n=e.querySelector(`.stage-box[data-id="${t}"]`);const s=multiGuestsState[t]?multiGuestsState[t].name:"GoÅ›Ä‡";if(n){if(3===n.childNodes[0].nodeType?n.childNodes[0].nodeValue=s:n.innerText=s,!n.querySelector(".resize-handle")){const e=document.createElement("div");e.className="resize-handle",n.appendChild(e)}}else{n=document.createElement("div"),n.className="stage-box",n.dataset.id=t,n.innerText=s,n.style.width=CAM_WIDTH_PCT+"%",n.style.height=CAM_HEIGHT_PCT+"%",n.style.left=2+2*o+"%",n.style.top=2+2*o+"%";const a=document.createElement("div");a.className="resize-handle",n.appendChild(a),setupInteractions(n),e.appendChild(n)}isLayoutLocked?n.classList.add("locked"):n.classList.remove("locked")})}function setupInteractions(e){let t,o,n,s,a,l,r,i,d=!1,c=!1;const u=e.querySelector(".resize-handle");e.addEventListener("mousedown",m=>{if(isLayoutLocked)return;const y=document.getElementById("free-mode-stage");m.target===u?(c=!0,m.stopPropagation()):d=!0,t=m.clientX,o=m.clientY,n=parseFloat(e.style.left)||0,s=parseFloat(e.style.top)||0,a=e.offsetWidth,l=e.offsetHeight,e.style.left.includes("%")||(n=e.offsetLeft/y.clientWidth*100,s=e.offsetTop/y.clientHeight*100);const p=e.getBoundingClientRect();r=m.clientX-p.left,i=m.clientY-p.top,e.style.zIndex=1e3}),document.addEventListener("mousemove",n=>{const s=document.getElementById("free-mode-stage"),u=s.clientWidth,m=s.clientHeight;if(c){const s=n.clientX-t,r=n.clientY-o,i=u-parseFloat(e.style.left)/100*u,d=m-parseFloat(e.style.top)/100*m;let c,y=a+s;y=Math.max(50,Math.min(y,i)),n.shiftKey?(c=l+r,c=Math.max(50,Math.min(c,d))):(c=y*(9/16),c>d&&(c=d,y=c*(16/9)));let p=y/u*100,g=c/m*100;e.style.width=p+"%",e.style.height=g+"%",broadcastCommand({type:"transform-update",targetId:e.dataset.id,x:parseFloat(e.style.left),y:parseFloat(e.style.top),w:parseFloat(p.toFixed(4)),h:parseFloat(g.toFixed(4))})}if(d){const t=n.altKey,o=s.getBoundingClientRect();let a=n.clientX-o.left,l=n.clientY-o.top,d=(a-r)/u*100,c=(l-i)/m*100;const y=parseFloat(e.style.width),p=parseFloat(e.style.height),g=document.getElementById("guide-x"),f=document.getElementById("guide-y");let h=!1,b=!1;if(!t){const t=1.5,o=Array.from(document.querySelectorAll(".stage-box")).filter(t=>t!==e);for(const e of o){const o=parseFloat(e.style.left),n=parseFloat(e.style.top),s=parseFloat(e.style.width),a=parseFloat(e.style.height);Math.abs(d-o)<t&&(d=o,h=!0),Math.abs(d-(o+s))<t&&(d=o+s,h=!0),Math.abs(d+y-o)<t&&(d=o-y,h=!0),Math.abs(d+y-(o+s))<t&&(d=o+s-y,h=!0),Math.abs(c-n)<t&&(c=n,b=!0),Math.abs(c-(n+a))<t&&(c=n+a,b=!0),Math.abs(c+p-n)<t&&(c=n-p,b=!0),Math.abs(c+p-(n+a))<t&&(c=n+a-p,b=!0)}}h?(g.style.display="block",g.style.left=d*u/100+"px"):g.style.display="none",b?(f.style.display="block",f.style.top=c*m/100+"px"):f.style.display="none",d=Math.max(0,Math.min(d,100-y)),c=Math.max(0,Math.min(c,100-p)),e.style.left=d+"%",e.style.top=c+"%",broadcastCommand({type:"transform-update",targetId:e.dataset.id,x:parseFloat(d.toFixed(4)),y:parseFloat(c.toFixed(4)),w:parseFloat(y.toFixed(4)),h:parseFloat(p.toFixed(4))})}}),document.addEventListener("mouseup",()=>{(d||c)&&(d=!1,c=!1,e.style.zIndex="",document.getElementById("guide-x").style.display="none",document.getElementById("guide-y").style.display="none")})}window.onload=function(){roomID?(document.getElementById("target-id").value=roomID,isMulti?(document.getElementById("status-msg").innerText="ğŸ“¡ Tryb Multi: SERWER AKTYWNY",document.getElementById("control-panel").style.display="block",peer.on("connection",handleIncomingConnection)):(document.getElementById("status-msg").innerText="Szukam OBS...",setTimeout(connectToOBS,1e3))):document.getElementById("status-msg").innerText="BÅÄ„D: Brak ID w linku."},document.addEventListener("keydown",e=>{e.ctrlKey&&e.shiftKey&&("F"===e.key||"f"===e.key)&&addFakeGuest()})</script></body></html>